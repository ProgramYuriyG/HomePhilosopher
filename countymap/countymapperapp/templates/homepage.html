<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>County Viewer</title>

        <!-- Bootstrap core CSS -->
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/plug-ins/f2c75b7247b/integration/bootstrap/3/dataTables.bootstrap.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

        <style>
            .centerImage {
                max-width: 90%;
                max-height: 90%;
                bottom: 0;
                left: 0;
                margin: auto;
                overflow: auto;
                right: 0;
                top: 0;
                -o-object-fit: contain;
                object-fit: contain;
            }

            svg{
                display: block;
                margin: auto;
            }

            body{
                overflow: False;
            }

            image {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>

    <body>
        <div class="container" width="100%">
            {% block header %}<h2 class="text-center">County Map</h2>{% endblock %}
        </div>
        <h1 class="text-center" id="slow_warning" style="display:none">
          Loading...
        </h1>
<!--        <div>-->
<!--        <form method="post" action="#">-->
<!--            {% csrf_token %}-->
<!--            <input name="state_field" type="text" placeholder="state, e.g. OH, RI, HI, DC" maxlength="2" onkeyup="this.value = this.value.toUpperCase()" required><br>-->
<!--            <input name="county_field" type="text" placeholder="county" onkeyup="this.value = this.value.toUpperCase()" required><br>-->
<!--            <input name="submit_state_county_button" type="submit">-->
<!--        </form>-->
<!--        </div>-->

<!--      {% if state_field %}-->
<!--          <div class="text-center">State: {{ state_field }}</div>-->
<!--          <div class="text-center">County: {{ county_field }}</div>-->
<!--      {% endif %}-->

        <form id="form_post" method="post" action="#">
            {% csrf_token %}
            <pre id="log_county">Selected Counties: </pre>
            <input id="county_names" type="text" name="county_names" value="" hidden>
            <input id="fips_ids" type="text" name="fips_ids" value="" hidden>
            <input id="submit_counties" name="submit_state_county_button" type="submit">
        </form>
        {% load static %}
        <object id="map" class="centerImage" style="height:100%;width:100%;" data="{% static 'USA_Counties_with_FIPS_and_names.svg' %}"  type="image/svg+xml">
            {% load static %}
            <img src="{% static 'USA_Counties_with_FIPS_and_names.svg' %}" />
        </object>

    </body>

    <script>
        map.onload = e => {
        const doc = map.getSVGDocument();
        color = "teal";

        doc.addEventListener('click', e => {
            log_text = doc.getElementById(e.target.id).getElementsByTagName("title")[0].innerHTML + "; ";
            fips_log = e.target.id + "; ";
            const prev = e.target.getAttribute("fill");
            data_fill = e.target.getAttribute("data-fill");
            if(e.target.id.includes("FIPS")){
                county_names.value += log_text;
                fips_ids.value += fips_log;
                log_county.textContent += log_text;

                const next = data_fill || color;
                if(next != color){
                    county_names.textContent = county_names.textContent.replaceAll(log_text, "");
                    fips_ids.textContent = fips_ids.textContent.replaceAll(fips_log, "");
                    log_county.textContent = log_county.textContent.replaceAll(log_text, "");
                }
                e.target.setAttribute('data-fill', prev);
                e.target.setAttribute('fill', next);
            }
        });
        };
    </script>

    <script>
        function show_slow_warning() {
          $("#slow_warning").show();
          $("#map").hide();
          $("#form_post").hide();
        }

        $(document).ready(function() {
          $('#submit_counties').click(function(){
            show_slow_warning();
          });
        });
    </script>
</html>
